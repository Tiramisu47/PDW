<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDW - integracja</title>
  </head>

  <style>
    body {
      display: flex;
      flex-direction: column;
      text-align: center;
      align-items: center;
      gap: 10px;
    }

    .control-section {
      display: none;
      flex-direction: column;
      text-align: center;
      gap: 5px;
      width: 256px;
    }
  </style>
  <body>
    <h1>JAKIS TYTUL</h1>
    <div id="output"></div>

    <div id="loginSection">
      <input
        type="text"
        id="sessionTokenInput"
        placeholder="Wpisz token sesji"
      />
      <button onclick="saveSessionToken()">Zapisz</button>
    </div>

    <div class="control-section" id="controlSection">
      <button onclick="toggle_1()">Swiatlo</button>
      <button onclick="toggle_2()">Drzwi</button>
      <input
        type="range"
        id="slider"
        min="0"
        max="100"
        value="0"
        step="1"
        oninput="range_3(this.value)"
      />
    </div>

    <script>
      let sessionToken = "";
      // Funkcja zapisywania tokenu sesji
      function saveSessionToken() {
        const tokenInput = document.getElementById("sessionTokenInput").value;
        if (tokenInput) {
          sessionToken = tokenInput;
          document.getElementById("loginSection").style.display = "none";
          document.getElementById("controlSection").style.display = "flex";
        } else {
          alert("Wpisz token sesji!");
        }
      }

      const socket = new WebSocket("ws://localhost:80");
      socket.addEventListener("open", function (event) {
        console.log("POLACZONO");
      });
      socket.addEventListener("message", function (event) {
        console.log("WIADOMOSC: ", event.data);
      });

      // FUNKCJE INTERAKCJI

      function toggle_1() {
        const message = {
          channelType: "core",
          eventType: "try_toggleElementState",
          sessionToken: sessionToken,
          elementUid: 1,
        };
        sendJSON(message);
      }

      function toggle_2() {
        const message = {
          channelType: "core",
          eventType: "try_toggleElementState",
          sessionToken: sessionToken,
          elementUid: 2,
        };
        sendJSON(message);
      }

      function range_3(value) {
        const message = {
          channelType: "core",
          eventType: "try_rangeElementState",
          sessionToken: sessionToken,
          elementUid: 3,
          value: value,
        };
        sendJSON(message);
      }

      function sendJSON(jsonObject) {
        if (socket.readyState === WebSocket.OPEN) {
          const jsonString = JSON.stringify(jsonObject);
          socket.send(jsonString);
          console.log("JSON sent:", jsonString);
        } else {
          console.log("WebSocket connection is not open");
        }
      }
    </script>
  </body>
</html>
